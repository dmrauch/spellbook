
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stroke Prediction - Data Preparation and Input Pipeline &#8212; spellbook</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tooltip.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script defer="defer" src="../../_static/tooltip.js"></script>
    <script src="../../_static/glossary.json"></script>
    <link rel="shortcut icon" href="../../_static/spellbook-icon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Stroke Prediction - Model Training and Validation" href="training-validation.html" />
    <link rel="prev" title="Stroke Prediction - Data Exploration and Cleaning" href="exploration-cleaning.html" />
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />




  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/spellbook-logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">spellbook</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search" aria-label="Search" autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  The spellbook Library
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../API.html">
   Source Code Reference
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../API-python.html">
     Python
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.input.html">
       spellbook.input
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.inspect.html">
       spellbook.inspect
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plot.html">
       spellbook.plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plot1D.html">
       spellbook.plot1D
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plot2D.html">
       spellbook.plot2D
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plotutils.html">
       spellbook.plotutils
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.stat.html">
       spellbook.stat
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.train.html">
       spellbook.train
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../tools.html">
   Tools and Technologies
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/anaconda.html">
     Anaconda / Conda
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/aws.html">
     AWS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/docker.html">
     Docker
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/git.html">
     Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/mkdocs.html">
     MkDocs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/python.html">
     Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/sphinx.html">
     Sphinx
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../tools/tf.html">
     TensorFlow
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../tools/tf-save.html">
       Saving and Loading Models
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/vscode.html">
     Visual Studio Code
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Projects &amp; Tutorials
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../examples/examples.html">
   Table of Contents
  </a>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="../../examples/1-binary-stroke-prediction/index.html">
   Classification: Stroke Prediction
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="exploration-cleaning.html">
     Data Exploration and Cleaning
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Data Preparation and Input Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="training-validation.html">
     Model Training and Validation
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2-tensorflow-decision-forests/code.html">
   Decision Forests in TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3-tensorflow-serving-docker/code.html">
   Serving TensorFlow Models in Docker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../examples/4-tf-serving-docker-aws/index.html">
   Serving TensorFlow Models on AWS
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Extras
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../literature.html">
   Links &amp; Literature
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
    <table style="margin-top:2.0rem;">
        <tr>
            <td style="text-align: left;">
                <a href="https://github.com/dmrauch">
                    <i class="fab fa-github-square"></i>
                </a>
            </td>
            <td style="padding-left: 0.5rem; text-align: left; font-style:italic; font-weight: bold;">
                Contact me on <a href="https://github.com/dmrauch">GitHub</a>
            </td>
        </tr>
        <tr>
            <td style="text-align: left;">
                <a href="https://www.linkedin.com/in/dmrauch/">
                    <i class="fab fa-linkedin"></i>
                </a>
            </td>
            <td style="padding-left: 0.5rem; text-align: left; font-style:italic; font-weight: bold;">
                Contact me on <a href="https://www.linkedin.com/in/dmrauch/">LinkedIn</a>
            </td>
        </tr>
    </table>
</div>
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            

            <a class="linkedin-button" href="https://www.linkedin.com/in/dmrauch/"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" aria-label="LinkedIn"
                title="Contact me on LinkedIn">
                <i class="fab fa-linkedin-in"></i>
                </button>
            </a>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/dmrauch"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Contact me on GitHub"><i
                    class="fab fa-github"></i>dmrauch profile</button></a>
        <a class="repository-button"
            href="https://github.com/dmrauch/spellbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>spellbook repository</button></a>
        <a class="issues-button"
            href="https://github.com/dmrauch/spellbook/issues/new?title=Issue%20on%20page%20%2F_examples/1-binary-stroke-prediction/input-pipeline.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/dmrauch/spellbook/edit/master/doc/source/_examples/1-binary-stroke-prediction/input-pipeline.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/_examples/1-binary-stroke-prediction/input-pipeline.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#treatment-of-categorical-variables">
   Treatment of Categorical Variables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feeding-the-dataset-into-tensorflow">
   Feeding the Dataset into
   <em>
    TensorFlow
   </em>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#option-1-using-tensorflow-datasets">
     Option 1: Using
     <em>
      TensorFlow
     </em>
     Datasets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#option-2-using-tensorflow-tensors">
     Option 2: Using
     <em>
      TensorFlow
     </em>
     Tensors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#option-3-using-numpy-arrays">
     Option 3: Using
     <em>
      NumPy
     </em>
     Arrays
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-1-binary-stroke-prediction-input-pipeline-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="stroke-prediction-data-preparation-and-input-pipeline">
<span id="binarystrokeprediction-inputpipeline"></span><span id="sphx-glr-examples-1-binary-stroke-prediction-input-pipeline-py"></span><h1>Stroke Prediction - Data Preparation and Input Pipeline<a class="headerlink" href="#stroke-prediction-data-preparation-and-input-pipeline" title="Permalink to this headline">¶</a></h1>
<p>Now let’s move on to bringing the data into a form that can be processed by
the neural network!</p>
<p>We’ll have a look at the three scripts</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">2-stroke-prediction-naive.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3-stroke-prediction-oversampling.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4-stroke-prediction-oversampling-norm.py</span></code></p></li>
</ul>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code>.</p>
<div class="section" id="treatment-of-categorical-variables">
<h2>Treatment of Categorical Variables<a class="headerlink" href="#treatment-of-categorical-variables" title="Permalink to this headline">¶</a></h2>
<p>After data loading and cleaning, we start off by processing the categorical
variables and manipulating them so that they can be digested by the network.</p>
<div class="margin sidebar">
<p class="sidebar-title">from <strong>2-stroke-prediction-naive.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># inplace convert string category labels to numerical indices</span>
<span class="n">categories</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">encode_categories</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>Behind the scenes, the function <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.encode_categories" title="spellbook.input.encode_categories"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.encode_categories()</span></code></a>
loops over all categorical variables in the dataset and converts them to
<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.Categorical.html#pandas.Categorical" title="(in pandas v1.2.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.Categorical</span></code></a>s.
A dictionary containing the mapping of the category names to numerical indices
for each categorical variable is returned:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">categories</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;female&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;male&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;other&#39;</span><span class="p">},</span>
    <span class="s1">&#39;hypertension&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">},</span>
    <span class="s1">&#39;heart_disease&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">},</span>
    <span class="s1">&#39;ever_married&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">},</span>
    <span class="s1">&#39;work_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;govt&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;never&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;private&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;self&#39;</span><span class="p">},</span>
    <span class="s1">&#39;residence_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;rural&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;urban&#39;</span><span class="p">},</span>
    <span class="s1">&#39;smoking_status&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;formerly&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;never&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;smokes&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;unknown&#39;</span><span class="p">},</span>
    <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, for each categorical
variable <code class="docutils literal notranslate"><span class="pre">var</span></code>, an additional column <code class="docutils literal notranslate"><span class="pre">var_codes</span></code> is added to the dataset,
containing the numerical category codes for each datapoint. These are the
columns that we will later feed into the network.</p>
<p>The corresponding code in <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.encode_categories" title="spellbook.input.encode_categories"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.encode_categories()</span></code></a> looks
like this:</p>
<div class="margin sidebar">
<p class="sidebar-title">from <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.encode_categories" title="spellbook.input.encode_categories"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.encode_categories()</span></code></a></p>
<p>in <a class="reference internal" href="../../_stubs/spellbook.input.html#module-spellbook.input" title="spellbook.input"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spellbook.input</span></code></a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">categories</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;variable &#39;</span><span class="si">{}</span><span class="s2">&#39; is categorical&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>

        <span class="c1"># taken from https://stackoverflow.com/a/51102402</span>
        <span class="n">categories</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">))</span>

        <span class="c1"># use numerical values instead of strings</span>
        <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="o">+</span><span class="s1">&#39;_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
</pre></div>
</div>
<p>Next, we are going to shuffle the dataset and order the rows randomly.
As we could see before, the original dataset is actually ordered in a way that
datapoints for patients with strokes come first. This is not what we want here
because when splitting the dataset into a training and a validation set, this
would mean that stroke cases would only be present in the training but not
the validation set. We do the shuffling with <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.sample.html#pandas.DataFrame.sample" title="(in pandas v1.2.5)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.sample()</span></code></a>
and afterwards continue to adjust our list of the feature variables and the
name of the target variable to point to the new columns holding the integer
category indices:</p>
<div class="margin sidebar">
<p class="sidebar-title">from <strong>2-stroke-prediction-naive.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># shuffle data either now in pandas or later in TensorFlow</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># use new numerical columns for the features</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">var</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;_codes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)]</span> <span class="o">=</span> <span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_codes&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="feeding-the-dataset-into-tensorflow">
<h2>Feeding the Dataset into <em>TensorFlow</em><a class="headerlink" href="#feeding-the-dataset-into-tensorflow" title="Permalink to this headline">¶</a></h2>
<p>Now it is time to split the data into a <em>training set</em>, which is used to
adjust the model parameters so as to describe the datapoints with
<code class="xref py py-meth docutils literal notranslate"><span class="pre">tf.keras.Model.fit()</span></code>, and a <em>validation set</em>. The latter is used to
evaluate the model performance and benchmark different models against each
other when changing model <a class="reference internal" href="../../glossary.html#term-hyperparameter"><span class="xref std std-term">hyperparameter</span></a>s such as the number of
layers, the number of nodes in a layer or the number of training epochs.</p>
<p>While doing the split, we are also going to convert the training and validation
datasets into objects that can be fed into the network. There are at least
three different ways of doing this in terms of the objects and datatypes
involved:</p>
<ol class="arabic simple">
<li><p>from a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> to a <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset" title="(in TensorFlow v2.4)"><code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code></a>
where features and labels are combined in one object</p></li>
<li><p>from a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> to two <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>s,
one for the features and one for the labels</p></li>
<li><p>from a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> to two <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>s,
one for the features and one for the labels</p></li>
</ol>
<p>Since columns in a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> can be accessed in much the
same way as entries in a <em>Python</em> <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, it is actually also possible
to directly feed features stored in a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> and labels
stored in a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.Series.html#pandas.Series" title="(in pandas v1.2.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.Series</span></code></a> into <em>TensorFlow</em> networks.
The separation of a single <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> into separate feature
and label sets for training, validation and testing is implemented in
<a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.split_pddataframe_to_pddataframes" title="spellbook.input.split_pddataframe_to_pddataframes"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.split_pddataframe_to_pddataframes()</span></code></a>.</p>
<div class="section" id="option-1-using-tensorflow-datasets">
<h3>Option 1: Using <em>TensorFlow</em> Datasets<a class="headerlink" href="#option-1-using-tensorflow-datasets" title="Permalink to this headline">¶</a></h3>
<p>This approach is taken in <code class="docutils literal notranslate"><span class="pre">2-stroke-prediction-naive.py</span></code>.
It is implemented in <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.split_pddataframe_to_tfdatasets" title="spellbook.input.split_pddataframe_to_tfdatasets"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.split_pddataframe_to_tfdatasets()</span></code></a>
and can be used like this:</p>
<div class="margin sidebar">
<p class="sidebar-title">from <strong>2-stroke-prediction-naive.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">split_pddataframe_to_tfdatasets</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">n_train</span><span class="o">=</span><span class="mi">3500</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">cardinality</span><span class="p">())</span> <span class="c1"># print the size of the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">cardinality</span><span class="p">())</span>
</pre></div>
</div>
<p>Using 3500 datapoints for the training set and the remaining 1409 for the
validation set corresponds to reserving a fraction of 71.3% of all data for
training. A typical recommendation is to use about 70% for training when
dealing with datasets containing a few thousand datapoints. As the size of
the total dataset increases, the fraction
reserved for training can increase and when a million datapoints are available,
it is perhaps sufficient to only use about 1% of them for validation.
Basically, the logic behind this is to use as many datapoints as possible for
training while at the same time ensuring that the validation (and possibly the
<a class="reference internal" href="../../glossary.html#term-testing"><span class="xref std std-term">testing</span></a>) set have sufficient size to provide numerically stable
results for the metrics used to quantify the model performance. The smaller
the validation set is, the larger the statistical uncertainty on the metrics
will be.</p>
<p>Under the hood, in <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.split_pddataframe_to_tfdatasets" title="spellbook.input.split_pddataframe_to_tfdatasets"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.split_pddataframe_to_tfdatasets()</span></code></a>,
the <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> is split into two separate frames,
one for the features and one for the target labels. These are converted to
two <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>s which are then used to initialise the
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset" title="(in TensorFlow v2.4)"><code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code></a> using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">tensorflow.data.Dataset.from_tensor_slices()</span></code> function. Finally, the
split is applied:</p>
<div class="margin sidebar">
<p class="sidebar-title">from <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.split_pddataframe_to_tfdatasets" title="spellbook.input.split_pddataframe_to_tfdatasets"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.split_pddataframe_to_tfdatasets()</span></code></a></p>
<p>in <a class="reference internal" href="../../_stubs/spellbook.input.html#module-spellbook.input" title="spellbook.input"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spellbook.input</span></code></a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">n_train</span><span class="p">,</span> <span class="n">n_val</span><span class="p">,</span> <span class="n">n_test</span> <span class="o">=</span> <span class="n">calculate_splits</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">frac_train</span><span class="p">,</span> <span class="n">frac_val</span><span class="p">,</span>
                                          <span class="n">n_train</span><span class="p">,</span> <span class="n">n_val</span><span class="p">)</span>

<span class="c1"># separate features and labels</span>
<span class="n">data_features</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
<span class="n">data_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>

<span class="c1"># create a TensorFlow Dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span>
    <span class="p">(</span><span class="n">data_features</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data_labels</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

<span class="c1"># split it into train/val/test</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">n_train</span><span class="p">)</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">n_train</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">n_val</span><span class="p">)</span>
<span class="k">if</span> <span class="n">n_test</span><span class="p">:</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">n_train</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">n_val</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">n_test</span><span class="p">)</span>
    <span class="k">return</span><span class="p">((</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span><span class="p">((</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that this does not shuffle and batch the resulting dataset. Shuffling
may be done</p>
<ul class="simple">
<li><p>before in <em>pandas</em>: <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">=</span> <span class="pre">data.sample(frac</span> <span class="pre">=</span> <span class="pre">1.0)</span></code></p></li>
<li><p>or afterwards in <em>TensorFlow</em>:
<code class="docutils literal notranslate"><span class="pre">train</span> <span class="pre">=</span> <span class="pre">train.shuffle(buffer_size</span> <span class="pre">=</span> <span class="pre">train.cardinality())</span></code></p></li>
</ul>
<p>Since we shuffled the data before converting and splitting them, we can
proceed to divide them into batches in <em>TensorFlow</em> with</p>
<div class="margin sidebar">
<p class="sidebar-title">from <strong>2-stroke-prediction-naive.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../glossary.html#term-batch"><span class="xref std std-term">batch</span></a> size of <code class="docutils literal notranslate"><span class="pre">100</span></code> is chosen so that each batch contains at
least some stroke cases.</p>
</div>
<div class="section" id="option-2-using-tensorflow-tensors">
<h3>Option 2: Using <em>TensorFlow</em> Tensors<a class="headerlink" href="#option-2-using-tensorflow-tensors" title="Permalink to this headline">¶</a></h3>
<p>Used in <code class="docutils literal notranslate"><span class="pre">3-stroke-prediction-oversampling.py</span></code>
and implemented in <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.separate_tfdataset_to_tftensors" title="spellbook.input.separate_tfdataset_to_tftensors"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.separate_tfdataset_to_tftensors()</span></code></a>.</p>
<p>Just like before, <em>TensorFlow</em> <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code></a>s for training and
validation are created. This time, they are each split into two separate
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>s - one for the features and one for the labels:</p>
<div class="margin sidebar">
<p class="sidebar-title">from <strong>3-stroke-prediction-oversampling.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">split_pddataframe_to_tfdatasets</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">n_train</span><span class="o">=</span><span class="mi">7000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">cardinality</span><span class="p">())</span> <span class="c1"># print the size of the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">cardinality</span><span class="p">())</span>

<span class="c1"># separate features and labels</span>
<span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">separate_tfdataset_to_tftensors</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">val_features</span><span class="p">,</span> <span class="n">val_labels</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">separate_tfdataset_to_tftensors</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
<p>Please don’t mind the increased size of the training set for now - this script
uses <em>oversampling</em> to deal with the imbalance in the <code class="docutils literal notranslate"><span class="pre">stroke</span></code> categories.
We will look into this in more detail later.</p>
<p>The advantage of this <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>-based approach is that it yields
a separate object containing just the target
labels, which can then be used when evaluating the model performance, e.g.
when calculating a confusion matrix or a <a class="reference internal" href="../../glossary.html#term-ROC"><span class="xref std std-term">ROC</span></a> curve from comparisons
of the predicted labels against the actual true target labels.</p>
<p>Internally, <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.separate_tfdataset_to_tftensors" title="spellbook.input.separate_tfdataset_to_tftensors"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.separate_tfdataset_to_tftensors()</span></code></a> proceeds as follows:</p>
<div class="margin sidebar">
<p class="sidebar-title">from <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.separate_tfdataset_to_tftensors" title="spellbook.input.separate_tfdataset_to_tftensors"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.separate_tfdataset_to_tftensors()</span></code></a></p>
<p>in <a class="reference internal" href="../../_stubs/spellbook.input.html#module-spellbook.input" title="spellbook.input"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spellbook.input</span></code></a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># unpack the feature and label tensors from the dataset</span>
<span class="c1"># and reshape them into two separate tuples of tensors</span>
<span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">dataset</span><span class="p">)</span>

<span class="c1"># [...]</span>

<span class="c1"># which are then stacked to form the features and labels tensors</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, since <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>s cannot be batched, in this approach, the
batching is left to the call to <code class="xref py py-meth docutils literal notranslate"><span class="pre">tf.keras.Model.fit()</span></code> later after model
setup.</p>
</div>
<div class="section" id="option-3-using-numpy-arrays">
<span id="binarystrokeprediction-numpyarrays"></span><h3>Option 3: Using <em>NumPy</em> Arrays<a class="headerlink" href="#option-3-using-numpy-arrays" title="Permalink to this headline">¶</a></h3>
<p>Used in <code class="docutils literal notranslate"><span class="pre">4-stroke-prediction-oversampling-norm.py</span></code>
and implemented in <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.split_pddataframe_to_nparrays" title="spellbook.input.split_pddataframe_to_nparrays"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.split_pddataframe_to_nparrays()</span></code></a>.</p>
<p>The third option is to split the dataset into <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>s:</p>
<div class="margin sidebar">
<p class="sidebar-title">from <strong>4-stroke-prediction-oversampling-norm.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">val_features</span><span class="p">,</span> <span class="n">val_labels</span> \
    <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">split_pddataframe_to_nparrays</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">n_train</span><span class="o">=</span><span class="mi">7000</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">train_features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># print the size of the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val_features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>The function <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.split_pddataframe_to_nparrays" title="spellbook.input.split_pddataframe_to_nparrays"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.split_pddataframe_to_nparrays()</span></code></a> works
like this in principle</p>
<div class="margin sidebar">
<p class="sidebar-title">from <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.split_pddataframe_to_nparrays" title="spellbook.input.split_pddataframe_to_nparrays"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.split_pddataframe_to_nparrays()</span></code></a></p>
<p>in <a class="reference internal" href="../../_stubs/spellbook.input.html#module-spellbook.input" title="spellbook.input"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spellbook.input</span></code></a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">n_train</span><span class="p">]</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">n_train</span><span class="p">:]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">n_val</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
          <span class="n">val</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

<span class="c1"># [...]</span>
<span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Like with <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>s in the previous approach, batching is left
the call to <code class="xref py py-meth docutils literal notranslate"><span class="pre">tf.keras.Model.fit()</span></code> later after model setup.</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-1-binary-stroke-prediction-input-pipeline-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/c4a1391bf527fadc02b5055ee8611621/input-pipeline.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">input-pipeline.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/035db1625c6230aed56a3bd45a2c8640/input-pipeline.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">input-pipeline.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>
</div>


              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="exploration-cleaning.html" title="previous page">Stroke Prediction - Data Exploration and Cleaning</a>
    <a class='right-next' id="next-link" href="training-validation.html" title="next page">Stroke Prediction - Model Training and Validation</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
            &copy; Copyright 2021, Daniel Rauch (dmrauch).<br/>
          Last updated on June 28, 2021.<br/>
          <div class="extra_footer">
            Built with <a href="https://www.sphinx-doc.org/en/master/index.html">Sphinx</a>
using the <a href="https://sphinx-book-theme.readthedocs.io/en/latest/">Sphinx Book Theme</a>
            &nbsp; | &nbsp;
            <a href="../../legal.html">Legal notes</a>
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>