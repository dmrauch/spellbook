
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Data Preparation and Input Pipeline &#8212; spellbook</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tooltip.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script defer="defer" src="../../_static/tooltip.js"></script>
    <script src="../../_static/glossary.json"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/spellbook-icon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Model Training and Validation" href="training-validation.html" />
    <link rel="prev" title="Data Exploration and Cleaning" href="exploration-cleaning.html" />
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/spellbook-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">spellbook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search" aria-label="Search" autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The spellbook Library
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../API.html">
   Source Code Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../API-python.html">
     Python
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.input.html">
       spellbook.input
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.inspect.html">
       spellbook.inspect
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plot.html">
       spellbook.plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plot1D.html">
       spellbook.plot1D
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plot2D.html">
       spellbook.plot2D
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plotutils.html">
       spellbook.plotutils
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.stat.html">
       spellbook.stat
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.train.html">
       spellbook.train
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tools.html">
   Tools and Technologies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/aws.html">
     AWS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/conda.html">
     Conda, Mamba &amp; Pip
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/docker.html">
     Docker
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/gcp.html">
     GCP
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../tools/git.html">
     Git
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tools/github.html">
       GitHub
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/jupyter.html">
     Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/mkdocs.html">
     MkDocs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/pandas.html">
     pandas
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../tools/python.html">
     Python
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tools/python-logging.html">
       Logging
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/rich.html">
     Rich
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/sphinx.html">
     Sphinx
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../tools/tf.html">
     TensorFlow
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tools/tf-save.html">
       Saving and Loading Models
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/virtualenv.html">
     virtualenv &amp; venv
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/vscode.html">
     Visual Studio Code
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Projects &amp; Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../examples.html">
   Table of Contents
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Binary Classification: Stroke Prediction
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="exploration-cleaning.html">
     Data Exploration and Cleaning
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Data Preparation and Input Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="training-validation.html">
     Model Training and Validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2-tensorflow-decision-forests/index.html">
   Decision Forests in TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../_examples/3-tensorflow-serving-docker/code.html">
   Serving
   <em>
    TensorFlow
   </em>
   Models in
   <em>
    Docker
   </em>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../4-tf-serving-docker-aws/index.html">
   <em>
    TensorFlow Serving
   </em>
   with
   <em>
    Docker
   </em>
   on
   <em>
    AWS
   </em>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Extras
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../literature.html">
   Links &amp; Literature
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../todo.html">
   ToDo List
  </a>
 </li>
</ul>

    </div>
</nav><div class="navbar_extra_footer">
    <table style="margin-top:2.0rem;">
        <tr>
            <td style="text-align: left;">
                <a href="https://github.com/dmrauch">
                    <img src="../../_static/GitHub-Mark-32px.png" height="16" padding-right="1em">
                </a>
            </td>
            <td style="padding-left: 0.5rem; text-align: left; font-style:italic; font-weight: bold;">
                Contact me on <a href="https://github.com/dmrauch">GitHub</a>
            </td>
        </tr>
        <tr>
            <td style="text-align: left;">
                <a href="https://www.linkedin.com/in/dmrauch/">
                    <img src="../../_static/LI-In-Bug.png" height="16" padding-right="1em"></td>
                </a>
            <td style="padding-left: 0.5rem; text-align: left; font-style:italic; font-weight: bold;">
                Contact me on <a href="https://www.linkedin.com/in/dmrauch/">LinkedIn</a>
            </td>
        </tr>
    </table>
</div></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/dmrauch/spellbook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/dmrauch/spellbook/issues/new?title=Issue%20on%20page%20%2Fexamples/1-binary-stroke-prediction/input-pipeline.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/dmrauch/spellbook/edit/master/doc/source/examples/1-binary-stroke-prediction/input-pipeline.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/examples/1-binary-stroke-prediction/input-pipeline.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#treatment-of-categorical-variables">
   Treatment of Categorical Variables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feeding-the-dataset-into-tensorflow">
   Feeding the Dataset into
   <em>
    TensorFlow
   </em>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#option-1-using-tensorflow-datasets">
     Option 1: Using
     <em>
      TensorFlow
     </em>
     Datasets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#option-2-using-tensorflow-tensors">
     Option 2: Using
     <em>
      TensorFlow
     </em>
     Tensors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#option-3-using-numpy-arrays">
     Option 3: Using
     <em>
      NumPy
     </em>
     Arrays
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Data Preparation and Input Pipeline</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#treatment-of-categorical-variables">
   Treatment of Categorical Variables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feeding-the-dataset-into-tensorflow">
   Feeding the Dataset into
   <em>
    TensorFlow
   </em>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#option-1-using-tensorflow-datasets">
     Option 1: Using
     <em>
      TensorFlow
     </em>
     Datasets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#option-2-using-tensorflow-tensors">
     Option 2: Using
     <em>
      TensorFlow
     </em>
     Tensors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#option-3-using-numpy-arrays">
     Option 3: Using
     <em>
      NumPy
     </em>
     Arrays
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="data-preparation-and-input-pipeline">
<span id="binarystrokeprediction-inputpipeline"></span><h1>Data Preparation and Input Pipeline<a class="headerlink" href="#data-preparation-and-input-pipeline" title="Permalink to this headline">#</a></h1>
<p>Now let’s move on to bringing the data into a form that can be processed by
the neural network!</p>
<p>We’ll have a look at the three scripts</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">2-stroke-prediction-naive.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3-stroke-prediction-oversampling.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4-stroke-prediction-oversampling-norm.py</span></code></p></li>
</ul>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code>.</p>
<section id="treatment-of-categorical-variables">
<h2>Treatment of Categorical Variables<a class="headerlink" href="#treatment-of-categorical-variables" title="Permalink to this headline">#</a></h2>
<p>After data loading and cleaning, we start off by processing the categorical
variables and manipulating them so that they can be digested by the network.</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <strong>2-stroke-prediction-naive.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># inplace convert string category labels to numerical indices</span>
<span class="n">categories</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">encode_categories</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>Behind the scenes, the function <code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.inputs.encode_categories()</span></code>
loops over all categorical variables in the dataset and converts them to
<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.Categorical.html#pandas.Categorical" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.Categorical</span></code></a>s.
A dictionary containing the mapping of the category names to numerical indices
for each categorical variable is returned:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">categories</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;female&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;male&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;other&#39;</span><span class="p">},</span>
    <span class="s1">&#39;hypertension&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">},</span>
    <span class="s1">&#39;heart_disease&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">},</span>
    <span class="s1">&#39;ever_married&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">},</span>
    <span class="s1">&#39;work_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;govt&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;never&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;private&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;self&#39;</span><span class="p">},</span>
    <span class="s1">&#39;residence_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;rural&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;urban&#39;</span><span class="p">},</span>
    <span class="s1">&#39;smoking_status&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;formerly&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;never&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;smokes&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;unknown&#39;</span><span class="p">},</span>
    <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, for each categorical
variable <code class="docutils literal notranslate"><span class="pre">var</span></code>, an additional column <code class="docutils literal notranslate"><span class="pre">var_codes</span></code> is added to the dataset,
containing the numerical category codes for each datapoint. These are the
columns that we will later feed into the network.</p>
<p>The corresponding code in <code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.inputs.encode_categories()</span></code> looks
like this:</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.encode_categories" title="spellbook.input.encode_categories"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.encode_categories()</span></code></a></p>
<p>in <a class="reference internal" href="../../_stubs/spellbook.input.html#module-spellbook.input" title="spellbook.input"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spellbook.input</span></code></a></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">categories</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;variable &#39;</span><span class="si">{}</span><span class="s2">&#39; is categorical&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>

        <span class="c1"># taken from https://stackoverflow.com/a/51102402</span>
        <span class="n">categories</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">))</span>

        <span class="c1"># use numerical values instead of strings</span>
        <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="o">+</span><span class="s1">&#39;_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
</pre></div>
</div>
<p>Next, we are going to shuffle the dataset and order the rows randomly.
As we could see before, the original dataset is actually ordered in a way that
datapoints for patients with strokes come first. This is not what we want here
because when splitting the dataset into a training and a validation set, this
would mean that stroke cases would only be present in the training but not
the validation set. We do the shuffling with <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.sample.html#pandas.DataFrame.sample" title="(in pandas v1.4.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.sample()</span></code></a>
and afterwards continue to adjust our list of the feature variables and the
name of the target variable to point to the new columns holding the integer
category indices:</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <strong>2-stroke-prediction-naive.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># shuffle data either now in pandas or later in TensorFlow</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># use new numerical columns for the features</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">var</span> <span class="o">==</span> <span class="n">target</span><span class="p">:</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;_codes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">features</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">)]</span> <span class="o">=</span> <span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_codes&#39;</span>
</pre></div>
</div>
</section>
<section id="feeding-the-dataset-into-tensorflow">
<h2>Feeding the Dataset into <em>TensorFlow</em><a class="headerlink" href="#feeding-the-dataset-into-tensorflow" title="Permalink to this headline">#</a></h2>
<p>Now it is time to split the data into a <em>training set</em>, which is used to
adjust the model parameters so as to describe the datapoints with
<code class="xref py py-meth docutils literal notranslate"><span class="pre">tf.keras.Model.fit()</span></code>, and a <em>validation set</em>. The latter is used to
evaluate the model performance and benchmark different models against each
other when changing model <a class="reference internal" href="../../glossary.html#term-hyperparameter"><span class="xref std std-term">hyperparameter</span></a>s such as the number of
layers, the number of nodes in a layer or the number of training epochs.</p>
<p>While doing the split, we are also going to convert the training and validation
datasets into objects that can be fed into the network. There are at least
three different ways of doing this in terms of the objects and datatypes
involved:</p>
<ol class="arabic simple">
<li><p>from a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> to a <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset" title="(in TensorFlow v2.4)"><code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code></a>
where features and labels are combined in one object</p></li>
<li><p>from a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> to two <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>s,
one for the features and one for the labels</p></li>
<li><p>from a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> to two <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.23)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>s,
one for the features and one for the labels</p></li>
</ol>
<p>Since columns in a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> can be accessed in much the
same way as entries in a <em>Python</em> <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, it is actually also possible
to directly feed features stored in a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> and labels
stored in a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.Series.html#pandas.Series" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.Series</span></code></a> into <em>TensorFlow</em> networks.
The separation of a single <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> into separate feature
and label sets for training, validation and testing is implemented in
<code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.inputs.split_pddataframe_to_pddataframes()</span></code>.</p>
<section id="option-1-using-tensorflow-datasets">
<h3>Option 1: Using <em>TensorFlow</em> Datasets<a class="headerlink" href="#option-1-using-tensorflow-datasets" title="Permalink to this headline">#</a></h3>
<p>This approach is taken in <code class="docutils literal notranslate"><span class="pre">2-stroke-prediction-naive.py</span></code>.
It is implemented in <code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.inputs.split_pddataframe_to_tfdatasets()</span></code>
and can be used like this:</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <strong>2-stroke-prediction-naive.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">split_pddataframe_to_tfdatasets</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">n_train</span><span class="o">=</span><span class="mi">3500</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">cardinality</span><span class="p">())</span> <span class="c1"># print the size of the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">cardinality</span><span class="p">())</span>
</pre></div>
</div>
<p>Using 3500 datapoints for the training set and the remaining 1409 for the
validation set corresponds to reserving a fraction of 71.3% of all data for
training. A typical recommendation is to use about 70% for training when
dealing with datasets containing a few thousand datapoints. As the size of
the total dataset increases, the fraction
reserved for training can increase and when a million datapoints are available,
it is perhaps sufficient to only use about 1% of them for validation.
Basically, the logic behind this is to use as many datapoints as possible for
training while at the same time ensuring that the validation (and possibly the
<a class="reference internal" href="../../glossary.html#term-testing"><span class="xref std std-term">testing</span></a>) set have sufficient size to provide numerically stable
results for the metrics used to quantify the model performance. The smaller
the validation set is, the larger the statistical uncertainty on the metrics
will be.</p>
<p>Under the hood, in <code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.inputs.split_pddataframe_to_tfdatasets()</span></code>,
the <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.4.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> is split into two separate frames,
one for the features and one for the target labels. These are converted to
two <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>s which are then used to initialise the
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset" title="(in TensorFlow v2.4)"><code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code></a> using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">tensorflow.data.Dataset.from_tensor_slices()</span></code> function. Finally, the
split is applied:</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.split_pddataframe_to_tfdatasets" title="spellbook.input.split_pddataframe_to_tfdatasets"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.split_pddataframe_to_tfdatasets()</span></code></a></p>
<p>in <a class="reference internal" href="../../_stubs/spellbook.input.html#module-spellbook.input" title="spellbook.input"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spellbook.input</span></code></a></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">n_train</span><span class="p">,</span> <span class="n">n_val</span><span class="p">,</span> <span class="n">n_test</span> <span class="o">=</span> <span class="n">calculate_splits</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">frac_train</span><span class="p">,</span> <span class="n">frac_val</span><span class="p">,</span>
                                          <span class="n">n_train</span><span class="p">,</span> <span class="n">n_val</span><span class="p">)</span>

<span class="c1"># separate features and labels</span>
<span class="n">data_features</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
<span class="n">data_labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>

<span class="c1"># create a TensorFlow Dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span>
    <span class="p">(</span><span class="n">data_features</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data_labels</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

<span class="c1"># split it into train/val/test</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">n_train</span><span class="p">)</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">n_train</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">n_val</span><span class="p">)</span>
<span class="k">if</span> <span class="n">n_test</span><span class="p">:</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">n_train</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">n_val</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">n_test</span><span class="p">)</span>
    <span class="k">return</span><span class="p">((</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span><span class="p">((</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that this does not shuffle and batch the resulting dataset. Shuffling
may be done</p>
<ul class="simple">
<li><p>before in <em>pandas</em>: <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">=</span> <span class="pre">data.sample(frac</span> <span class="pre">=</span> <span class="pre">1.0)</span></code></p></li>
<li><p>or afterwards in <em>TensorFlow</em>:
<code class="docutils literal notranslate"><span class="pre">train</span> <span class="pre">=</span> <span class="pre">train.shuffle(buffer_size</span> <span class="pre">=</span> <span class="pre">train.cardinality())</span></code></p></li>
</ul>
<p>Since we shuffled the data before converting and splitting them, we can
proceed to divide them into batches in <em>TensorFlow</em> with</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <strong>2-stroke-prediction-naive.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../../glossary.html#term-batch"><span class="xref std std-term">batch</span></a> size of <code class="docutils literal notranslate"><span class="pre">100</span></code> is chosen so that each batch contains at
least some stroke cases.</p>
</section>
<section id="option-2-using-tensorflow-tensors">
<h3>Option 2: Using <em>TensorFlow</em> Tensors<a class="headerlink" href="#option-2-using-tensorflow-tensors" title="Permalink to this headline">#</a></h3>
<p>Used in <code class="docutils literal notranslate"><span class="pre">3-stroke-prediction-oversampling.py</span></code>
and implemented in <code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.inputs.separate_tfdataset_to_tftensors()</span></code>.</p>
<p>Just like before, <em>TensorFlow</em> <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/data/Dataset" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code></a>s for training and
validation are created. This time, they are each split into two separate
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>s - one for the features and one for the labels:</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <strong>3-stroke-prediction-oversampling.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">split_pddataframe_to_tfdatasets</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">n_train</span><span class="o">=</span><span class="mi">7000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">cardinality</span><span class="p">())</span> <span class="c1"># print the size of the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">cardinality</span><span class="p">())</span>

<span class="c1"># separate features and labels</span>
<span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">separate_tfdataset_to_tftensors</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">val_features</span><span class="p">,</span> <span class="n">val_labels</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">separate_tfdataset_to_tftensors</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
<p>Please don’t mind the increased size of the training set for now - this script
uses <em>oversampling</em> to deal with the imbalance in the <code class="docutils literal notranslate"><span class="pre">stroke</span></code> categories.
We will look into this in more detail later.</p>
<p>The advantage of this <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>-based approach is that it yields
a separate object containing just the target
labels, which can then be used when evaluating the model performance, e.g.
when calculating a confusion matrix or a <a class="reference internal" href="../../glossary.html#term-ROC"><span class="xref std std-term">ROC</span></a> curve from comparisons
of the predicted labels against the actual true target labels.</p>
<p>Internally, <code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.inputs.separate_tfdataset_to_tftensors()</span></code> proceeds as follows:</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.separate_tfdataset_to_tftensors" title="spellbook.input.separate_tfdataset_to_tftensors"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.separate_tfdataset_to_tftensors()</span></code></a></p>
<p>in <a class="reference internal" href="../../_stubs/spellbook.input.html#module-spellbook.input" title="spellbook.input"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spellbook.input</span></code></a></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># unpack the feature and label tensors from the dataset</span>
<span class="c1"># and reshape them into two separate tuples of tensors</span>
<span class="n">features</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">dataset</span><span class="p">)</span>

<span class="c1"># [...]</span>

<span class="c1"># which are then stacked to form the features and labels tensors</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, since <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>s cannot be batched, in this approach, the
batching is left to the call to <code class="xref py py-meth docutils literal notranslate"><span class="pre">tf.keras.Model.fit()</span></code> later after model
setup.</p>
</section>
<section id="option-3-using-numpy-arrays">
<span id="binarystrokeprediction-numpyarrays"></span><h3>Option 3: Using <em>NumPy</em> Arrays<a class="headerlink" href="#option-3-using-numpy-arrays" title="Permalink to this headline">#</a></h3>
<p>Used in <code class="docutils literal notranslate"><span class="pre">4-stroke-prediction-oversampling-norm.py</span></code>
and implemented in <code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.inputs.split_pddataframe_to_nparrays()</span></code>.</p>
<p>The third option is to split the dataset into <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.23)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>s:</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <strong>4-stroke-prediction-oversampling-norm.py</strong></p>
<p>in <code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_features</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">val_features</span><span class="p">,</span> <span class="n">val_labels</span> \
    <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">split_pddataframe_to_nparrays</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">n_train</span><span class="o">=</span><span class="mi">7000</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">train_features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># print the size of the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val_features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>The function <code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.inputs.split_pddataframe_to_nparrays()</span></code> works
like this in principle</p>
<aside class="margin sidebar">
<p class="sidebar-title">from <a class="reference internal" href="../../_stubs/spellbook.input.html#spellbook.input.split_pddataframe_to_nparrays" title="spellbook.input.split_pddataframe_to_nparrays"><code class="xref py py-func docutils literal notranslate"><span class="pre">spellbook.input.split_pddataframe_to_nparrays()</span></code></a></p>
<p>in <a class="reference internal" href="../../_stubs/spellbook.input.html#module-spellbook.input" title="spellbook.input"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spellbook.input</span></code></a></p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">n_train</span><span class="p">]</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">n_train</span><span class="p">:]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">n_val</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
          <span class="n">val</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

<span class="c1"># [...]</span>
<span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Like with <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Tensor" title="(in TensorFlow v2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tf.Tensor</span></code></a>s in the previous approach, batching is left
the call to <code class="xref py py-meth docutils literal notranslate"><span class="pre">tf.keras.Model.fit()</span></code> later after model setup.</p>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="exploration-cleaning.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Data Exploration and Cleaning</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="training-validation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Model Training and Validation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
      &copy; Copyright 2021, Daniel Rauch (dmrauch).<br/>
    Last updated on August 7, 2022.<br/>
    <div class="extra_footer">
      Built with <a href="https://www.sphinx-doc.org/en/master/index.html">Sphinx</a>
using the <a href="https://sphinx-book-theme.readthedocs.io/en/latest/">Sphinx Book Theme</a>
    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>