
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Binary Classification with the Stroke Prediction Dataset &#8212; spellbook</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tooltip.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script defer="defer" src="../../_static/tooltip.js"></script>
    <script src="../../_static/glossary.json"></script>
    <link rel="shortcut icon" href="../../_static/spellbook-icon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Data Exploration and Cleaning" href="exploration-cleaning.html" />
    <link rel="prev" title="Projects &amp; Tutorials" href="../examples.html" />
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />




  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/spellbook-logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">spellbook</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search" aria-label="Search" autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  The spellbook Library
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../API.html">
   Source Code Reference
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../API-python.html">
     Python
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.input.html">
       spellbook.input
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.inspect.html">
       spellbook.inspect
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plot.html">
       spellbook.plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plot1D.html">
       spellbook.plot1D
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plot2D.html">
       spellbook.plot2D
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.plotutils.html">
       spellbook.plotutils
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.stat.html">
       spellbook.stat
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../_stubs/spellbook.train.html">
       spellbook.train
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../tools.html">
   Tools and Technologies
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/anaconda.html">
     Anaconda / Conda
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/aws.html">
     AWS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/docker.html">
     Docker
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/git.html">
     Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/mkdocs.html">
     MkDocs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/python.html">
     Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/sphinx.html">
     Sphinx
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../tools/tf.html">
     TensorFlow
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../tools/tf-save.html">
       Saving and Loading Models
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/vscode.html">
     Visual Studio Code
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Projects &amp; Tutorials
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../examples.html">
   Table of Contents
  </a>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="current reference internal" href="#">
   Binary Classification: Stroke Prediction
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="exploration-cleaning.html">
     Data Exploration and Cleaning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="input-pipeline.html">
     Data Preparation and Input Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="training-validation.html">
     Model Training and Validation
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2-tensorflow-decision-forests/index.html">
   Decision Forests in TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../_examples/3-tensorflow-serving-docker/code.html">
   Serving
   <em>
    TensorFlow
   </em>
   Models in
   <em>
    Docker
   </em>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../4-tf-serving-docker-aws/index.html">
   <em>
    TensorFlow Serving
   </em>
   with
   <em>
    Docker
   </em>
   on
   <em>
    AWS
   </em>
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Extras
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../literature.html">
   Links &amp; Literature
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
    <table style="margin-top:2.0rem;">
        <tr>
            <td style="text-align: left;">
                <a href="https://github.com/dmrauch">
                    <img src="../../_static/GitHub-Mark-32px.png" height="16" padding-right="1em">
                </a>
            </td>
            <td style="padding-left: 0.5rem; text-align: left; font-style:italic; font-weight: bold;">
                Contact me on <a href="https://github.com/dmrauch">GitHub</a>
            </td>
        </tr>
        <tr>
            <td style="text-align: left;">
                <a href="https://www.linkedin.com/in/dmrauch/">
                    <img src="../../_static/LI-In-Bug.png" height="16" padding-right="1em"></td>
                </a>
            <td style="padding-left: 0.5rem; text-align: left; font-style:italic; font-weight: bold;">
                Contact me on <a href="https://www.linkedin.com/in/dmrauch/">LinkedIn</a>
            </td>
        </tr>
    </table>
</div>
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/examples/1-binary-stroke-prediction/index.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/dmrauch/spellbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/dmrauch/spellbook/issues/new?title=Issue%20on%20page%20%2Fexamples/1-binary-stroke-prediction/index.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/dmrauch/spellbook/edit/master/doc/source/examples/1-binary-stroke-prediction/index.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary-without-implementation-details">
   Summary without Implementation Details
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="binary-classification-with-the-stroke-prediction-dataset">
<h1>Binary Classification with the Stroke Prediction Dataset<a class="headerlink" href="#binary-classification-with-the-stroke-prediction-dataset" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="tag-list">
   <div class="tag-cell tag-date">June 13, 2021</div>
   <div class="tag-cell tag-center"></div>
   <div class="tag-cell tag-right">
      <span class="tag-text">tags:</span>
      <a class="tag right" href="../../search.html?q=tags+binary+classification">
         binary classification</a>
      <a class="tag right" href="../../search.html?q=tags+imbalanced+data">
         imbalanced data</a>
      <a class="tag right" href="../../search.html?q=tags+oversampling">
         oversampling</a>
      <a class="tag right" href="../../search.html?q=tags+supervised+learning">
         supervised learning</a>
   </div>
</div><div class="spellbook-admonition-orange admonition">
<p class="admonition-title">In this project/tutorial, we will</p>
<ul class="simple">
<li><p><strong>Explore</strong> the <a class="reference external" href="https://www.kaggle.com/fedesoriano/stroke-prediction-dataset">Stroke Prediction Dataset</a> and
inspect and <strong>plot</strong> its variables and their correlations by means of the
<em>spellbook</em> library</p></li>
<li><p>Set up an <strong>input pipeline</strong> that loads the data from the original <code class="docutils literal notranslate"><span class="pre">*.csv</span></code>
file, preprocesses them and feeds them into a neural network</p></li>
<li><p>Use <strong>TensorFlow</strong> to train a <strong>neural network / multi-layer perceptron</strong>
to do <strong>binary classification</strong></p></li>
<li><p>Encounter the problem of <strong>imbalanced data</strong> and explore the strategy of
<strong>oversampling</strong> to address it</p></li>
<li><p>See what effect even a very basic <strong>normalisation of the input data</strong> can
have on the model performance</p></li>
</ul>
</div>
<p>Here on this page, I will give a summary of the key points and ideas of this
project without any code snippets. The technical and implementation details
are then laid out in depth on the next pages of this tutorial:</p>
<ul class="simple">
<li><p><a class="reference internal" href="exploration-cleaning.html"><span class="doc">Data Exploration and Cleaning</span></a></p></li>
<li><p><a class="reference internal" href="input-pipeline.html"><span class="doc">Data Preparation and Input Pipeline</span></a></p></li>
<li><p><a class="reference internal" href="training-validation.html"><span class="doc">Model Training and Validation</span></a></p></li>
</ul>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Install the <em>spellbook</em> library as detailed in <a class="reference internal" href="../../index.html#installation"><span class="std std-ref">Installation</span></a></p></li>
<li><p>The source code for this tutorial is located in
<code class="docutils literal notranslate"><span class="pre">examples/1-binary-stroke-prediction/</span></code></p></li>
<li><p>Download the <a class="reference external" href="https://www.kaggle.com/fedesoriano/stroke-prediction-dataset">Stroke Prediction Dataset</a> from
Kaggle and extract the file <code class="docutils literal notranslate"><span class="pre">healthcare-dataset-stroke-data.csv</span></code></p></li>
</ul>
</div>
<div class="section" id="summary-without-implementation-details">
<h2>Summary without Implementation Details<a class="headerlink" href="#summary-without-implementation-details" title="Permalink to this headline">¶</a></h2>
<p>This dataset contains a total of 5110 datapoints, each of them describing a
patient, whether they have had a stroke or not, as well as 10 other variables,
ranging from gender, age and type of work to the existence of medical
conditions such as heart problems or hypertension.</p>
<p>The task we are going to pursue is <a class="reference internal" href="../../glossary.html#term-binary-classification"><span class="xref std std-term">binary classification</span></a>, specifically
the prediction of the presence of a stroke based on the other variables.
The key characteristic of this dataset is the stark imbalance in the fractions
of patients with a stroke vs. the ones without.
This situation of very differently populated target classes is called
<a class="reference internal" href="../../glossary.html#term-imbalanced-data"><span class="xref std std-term">imbalanced data</span></a>.</p>
<p>For 201 datapoints, no BMI was given. While it may be
worthwhile to consider imputing these values, we will drop the affected
datapoints for now. 4909 datapoints remain with 4.3% of the people having
suffered a stroke.</p>
<table class="spellbook-gallery-wrap table" id="ex1-fig-variables">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="figure align-default" id="id2">
<a class="reference internal image-reference" href="../../_images/stroke.png"><img alt="../../_images/stroke.png" src="../../_images/stroke.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 1: The binary target variable</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-default" id="id3">
<a class="reference internal image-reference" href="../../_images/variables.png"><img alt="../../_images/variables.png" src="../../_images/variables.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 2: Distributions of all variables</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</td>
</tr>
</tbody>
</table>
<p>Let us first follow the <em>naive</em> approach by ignoring the imbalance and train
a simple fully-connected neural network / multi-layer perceptron on a training
set of 3500 datapoints, leaving us with a validation dataset of 1409 datapoints.
In this tutorial, I am using a network with three hidden dense layers of 10,
100 and 50 units/nodes/neurons, respectively, and an output layer, interleaved
with two <a class="reference internal" href="../../glossary.html#term-dropout"><span class="xref std std-term">dropout</span></a> layers, and with <a class="reference internal" href="../../glossary.html#term-L2-regularisation"><span class="xref std std-term">L2 regularisation</span></a> activated
in the largest hidden dense layer. The output layer consists of a
single sigmoid-activated
neuron. This architecture is the result of manually trying out different model
configurations in the later stages of this tutorial, but we are using the same
network throughout in order to have a fair comparison of the different training
strategies.</p>
<p>Very quickly, already in the first 10 epochs, the loss and the accuracy flatten
off, as can be seen in Figure 3. The accuracy settles at
around 96%, which just corresponds to the fraction of healthy people in the
dataset. Looking at the confusion matrix calculated from the predictions for
the validation dataset and shown in Figure 4, we can confirm that the model is
not at all picking up the positive cases and is purely and only predicting the
negative class, i.e. the absence of a stroke. Therefore, the accuracy, although
appearing to be good, cannot capture the fact that this model is inadequate.</p>
<table class="spellbook-gallery-wrap table">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="figure align-default" id="id4">
<a class="reference internal image-reference" href="../../_images/naive-e100-history-loss-acc.png"><img alt="../../_images/naive-e100-history-loss-acc.png" src="../../_images/naive-e100-history-loss-acc.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 3: Naive approach: loss and accuracy</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-default" id="id5">
<a class="reference internal image-reference" href="../../_images/naive-e100-confusion-edited.png"><img alt="../../_images/naive-e100-confusion-edited.png" src="../../_images/naive-e100-confusion-edited.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 4: Naive approach: Confusion matrix</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</td>
</tr>
</tbody>
</table>
<p>So let’s try an approach aimed at dealing with imbalanced data and <em>oversample
the minority class</em>, i.e. the positive class containing the patients with a
stroke in this example. In this strategy, we create an artificial dataset
that is populated in equal numbers with the positive and the negative class.
This is achieved by separating the full dataset into patients with a stroke
and patients without a stroke and then drawing with replacement from the
<code class="docutils literal notranslate"><span class="pre">stroke</span> <span class="pre">=</span> <span class="pre">yes</span></code> class as many times as there are datapoints in the
<code class="docutils literal notranslate"><span class="pre">stroke</span> <span class="pre">=</span> <span class="pre">no</span></code> class (4700 datapoints). Of course, this means that the same
datapoints of patients with a stroke will be included multiple times but the
point is to create a balanced dataset (with 2 * 4700 datapoints)
so that the model can learn the characteristics of both classes with equal
emphasis. Also, adopting the opposite approach of downsampling the majority
class would throw away a lot of good data and leave us with a very limited
dataset of only 2 * 209 datapoints.</p>
<p>When training the same model on this new, balanced dataset, we can see a lower
initial accuracy of about 70%, increasing slowly but steadily as the training
continues, as depicted in Figure 5. Likewise the loss is somewhat
larger than in the naive case, but steadily decreases over time. When looking
at the evolution of the numbers of true and false positives and negatives,
given in Figure 6, we can see that the model is now definitely predicting
datapoints to belong to the positive class as well. Moreover, the false
predictions decrease during training and the confusion matrix based on the
validation dataset given in Figure 7 shows that of all the patients with a
stroke less than 1% were predicted to be healthy. These are the <em>false
negatives</em> (<a class="reference internal" href="../../glossary.html#term-FN"><span class="xref std std-term">FN</span></a>), which are of particular interest in the context of
tests or models in medicine because a falsely negative classification means
that a patient’s condition is not recognised. On the other side, the
confusion matrix indicates that 27.6% of all truly negative cases were
predicted to be positive during validation. This is the
<em>false positive rate</em> (<a class="reference internal" href="../../glossary.html#term-FPR"><span class="xref std std-term">FPR</span></a>). A false positive corresponds to worrying
a patient with an alarming test result, normally triggering more tests.</p>
<table class="spellbook-gallery-wrap table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="figure align-default" id="id6">
<a class="reference internal image-reference" href="../../_images/oversampling-e500-history-loss-acc.png"><img alt="../../_images/oversampling-e500-history-loss-acc.png" src="../../_images/oversampling-e500-history-loss-acc.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 5: Oversampling: loss and accuracy</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-default" id="id7">
<a class="reference internal image-reference" href="../../_images/oversampling-e500-history-pos-neg.png"><img alt="../../_images/oversampling-e500-history-pos-neg.png" src="../../_images/oversampling-e500-history-pos-neg.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 6: Oversampling: true/false positives/negatives</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-default" id="id8">
<a class="reference internal image-reference" href="../../_images/oversampling-e500-confusion-norm-true.png"><img alt="../../_images/oversampling-e500-confusion-norm-true.png" src="../../_images/oversampling-e500-confusion-norm-true.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 7: Oversampling: confusion matrix normalised by the true labels</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
</td>
</tr>
</tbody>
</table>
<p>But while, especially from the patients’ perspective, it is preferable to
beat down the false negatives as much as possible in order to minimise the
risk of not detecting a true condition, it would also be nice to simultaneously
minimise the probability of false positives. For patients, this will lead to
less false alarms, and for the healthcare sector, this corresponds to less
follow-up tests and therefore less cost. For a given model, however, false
positives can only be traded against false negatives and
decreasing one will result in an increase of the other. This can be seen on
the Receiver Operator Characteristic (<a class="reference internal" href="../../glossary.html#term-ROC"><span class="xref std std-term">ROC</span></a>) curves, into which we will
look later. Therefore, decreasing both the false positives and negatives at
the same time can only be achieved by creating a better-performing model.</p>
<p>So let’s explore the impact of another technique typically used to improve
model performance, <em>normalisation of the input data</em>. It consists of
scaling down the numerical values of continuous variables and restricting
them to some interval close to or around zero, typically with an interval
length of the order of one. This strategy is based on the experience that
models can achieve better performance when fed with small numbers as opposed
to values of the order of tens, hundreds or more. While there are more
involved variants of this principle, such as <em>standardisation</em>, we will just
perform a very simple normalisation by division and scale down age and BMI
by a factor of 100, and the average glucose level by a factor of 300.
The resulting distributions retain their original shape as can be seen in
Figure 8.</p>
<table class="spellbook-gallery-wrap table">
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="figure align-default" id="id9">
<a class="reference internal image-reference" href="../../_images/variables-normalised.png"><img alt="../../_images/variables-normalised.png" src="../../_images/variables-normalised.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 8: Normalised continuous variables</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
</td>
</tr>
</tbody>
</table>
<p>After training for 2000 epochs with both oversampling and input normalisation,
we should check the various metrics for signs of <a class="reference internal" href="../../glossary.html#term-overtraining"><span class="xref std std-term">overtraining</span></a> which
would show up as a significantly better model performance on the training
data compared to the validation data. As an example, the evolution of the
loss and the accuracy is shown in Figure 9, indicating that there is no
overtraining. The confusion matrix is given in Figure 10. The false negatives
have gone down even further and we can now see that the false positives have
improved as well,
from 27.6% before to now 9.5%. This is also reflected in the <a class="reference internal" href="../../glossary.html#term-ROC"><span class="xref std std-term">ROC</span></a> curves
given in Figure 11 which compare the performance of all three models:</p>
<ul class="simple">
<li><p>the original naive model, trained over 100 epochs</p></li>
<li><p>the model trained on the oversampled dataset for 2000 epochs</p></li>
<li><p>the final model with both oversampling and normalisation of the inputs,
trained over 2000 epochs</p></li>
</ul>
<p>The standard working points based on a
sigmoid-activated classifier output of 0.5 are indicated with filled red
circles. The better the performance of a model, the more its <a class="reference internal" href="../../glossary.html#term-ROC"><span class="xref std std-term">ROC</span></a> curve extends
to the top left corner, corresponding to simultaneously low false positives
and false negatives, the latter indicated by a high true positive rate
(<a class="reference internal" href="../../glossary.html#term-TPR"><span class="xref std std-term">TPR</span></a>). Therefore, one metric typically used to compare the performance
of different models is the <em>area under the curve</em> (<a class="reference internal" href="../../glossary.html#term-AUC"><span class="xref std std-term">AUC</span></a>) of the <a class="reference internal" href="../../glossary.html#term-ROC"><span class="xref std std-term">ROC</span></a>
curves. As already seen from the confusion matrices, the last model with both
oversampling and normalisation of the inputs performs best, reaching AUCs of
0.99 in both training and validation.</p>
<table class="spellbook-gallery-wrap table">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="figure align-default" id="id10">
<a class="reference internal image-reference" href="../../_images/oversampling-normalised-e2000-history-loss-acc.png"><img alt="../../_images/oversampling-normalised-e2000-history-loss-acc.png" src="../../_images/oversampling-normalised-e2000-history-loss-acc.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 9: Evolution of loss and accuracy</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-default" id="id11">
<a class="reference internal image-reference" href="../../_images/oversampling-normalised-e2000-confusion-norm-true.png"><img alt="../../_images/oversampling-normalised-e2000-confusion-norm-true.png" src="../../_images/oversampling-normalised-e2000-confusion-norm-true.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 10: Confusion matrix for normalisation and oversampling</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
</td>
<td><div class="figure align-default" id="id12">
<a class="reference internal image-reference" href="../../_images/roc-2000-naive-oversampling-normalised.png"><img alt="../../_images/roc-2000-naive-oversampling-normalised.png" src="../../_images/roc-2000-naive-oversampling-normalised.png" style="height: 250px;" /></a>
<p class="caption"><span class="caption-text">Figure 11: <a class="reference internal" href="../../glossary.html#term-ROC"><span class="xref std std-term">ROC</span></a> curves of the different models</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>


              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="../examples.html" title="previous page">Projects &amp; Tutorials</a>
    <a class='right-next' id="next-link" href="exploration-cleaning.html" title="next page">Data Exploration and Cleaning</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
            &copy; Copyright 2021, Daniel Rauch (dmrauch).<br/>
          Last updated on June 26, 2021.<br/>
          <div class="extra_footer">
            Built with <a href="https://www.sphinx-doc.org/en/master/index.html">Sphinx</a>
using the <a href="https://sphinx-book-theme.readthedocs.io/en/latest/">Sphinx Book Theme</a>
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>